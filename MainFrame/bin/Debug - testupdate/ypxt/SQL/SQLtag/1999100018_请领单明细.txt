declare @page_no integer,@in_date datetime
select @page_no=:page_no,@in_date=:in_date   

select yp_in_plan.*,
       yp_dict.drugname,yp_dict.specification,
       yp_dict.retprice,yp_dict.fix_price,   
       yp_base.stock_amount as outstock_amount,  
       yp_group_name.dept_name chinagroup_no_out,
       a_employee_mi.name drawer_name,
       cj.abbr_name manufactory_name,
       dbo.yp_getdrugnameBM(yp_dict.drug_id) drugnameBM
from yp_in_plan
     left join  yp_dict   on  yp_in_plan.charge_code =yp_dict.charge_code  and yp_in_plan.serial =yp_dict.serial
     left join   yp_group_name  on  yp_in_plan.group_no_out =yp_group_name.group_no
     left join   a_employee_mi  on  yp_in_plan.drawer = a_employee_mi.emp_sn
     left join   yp_base       on yp_in_plan.charge_code=yp_base.charge_code  and yp_in_plan.serial=yp_base.serial
                      and  yp_in_plan.group_no_out=yp_base.group_no
     left join   yp_manufacture cj on yp_dict.manufactory=cj.manu_code
where yp_in_plan.page_no = @page_no
   and yp_in_plan.in_date = @in_date
                                 